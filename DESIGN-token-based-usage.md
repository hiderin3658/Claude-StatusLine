# ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ä½¿ç”¨é‡è¨ˆç®— è©³ç´°è¨­è¨ˆ

## 1. æ¦‚è¦

### 1.1 ç›®çš„
Claude Code ã®ä½¿ç”¨é‡ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã§è¨ˆç®—ã—ã€5æ™‚é–“ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†…ã®æ¶ˆè²»ç‡ã‚’ã‚ˆã‚Šæ­£ç¢ºã«æ¨å®šã™ã‚‹ã€‚

### 1.2 ç¾çŠ¶ã®å•é¡Œç‚¹
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹ã§ã¯æ¶ˆè²»é‡ã®å¤‰å‹•ãŒå¤§ãã„
- ãƒ¢ãƒ‡ãƒ«åˆ¥ã®é‡ã¿ä»˜ã‘ä¿‚æ•°ãŒæ¨æ¸¬å€¤
- åˆ¶é™å€¤ï¼ˆåˆ†æ¯ï¼‰ãŒéå…¬é–‹

### 1.3 æ–°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- assistant ã‚¤ãƒ™ãƒ³ãƒˆã® `usage` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’ç›´æ¥å–å¾—
- APIä¾¡æ ¼æ¯”ç‡ã«åŸºã¥ãå…¬å¼ãªé‡ã¿ä»˜ã‘ã‚’é©ç”¨
- ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã§å®Ÿæ¸¬åˆ¶é™å€¤ã‚’è¨˜éŒ²

---

## 2. è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¯¾å¿œ

### 2.1 è¦ä»¶

| é …ç›® | è¡¨ç¤ºæ–¹æ³• |
|------|---------|
| **ä½¿ç”¨é‡ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ï¼‰** | å…¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®**åˆè¨ˆ**ã‚’è¡¨ç¤º |
| **ä½¿ç”¨ä¸­ãƒ¢ãƒ‡ãƒ«** | å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§**å€‹åˆ¥**ã«è¡¨ç¤º |

### 2.2 è¨­è¨ˆæ–¹é‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Claude Code ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ A (Opus 4.5)                       â”‚
â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³: [Opus 4.5] ğŸ“ project-a | main | 5h:45%  â”‚
â”‚                                    â†‘å€‹åˆ¥          â†‘åˆè¨ˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Claude Code ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ B (Sonnet 4.5)                     â”‚
â”‚ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³: [Sonnet 4.5] ğŸ“ project-b | dev | 5h:45% â”‚
â”‚                                     â†‘å€‹åˆ¥          â†‘åˆè¨ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å®Ÿç¾æ–¹æ³•

#### ä½¿ç”¨é‡ï¼ˆåˆè¨ˆï¼‰
- `get-message-usage.py` ãŒå…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ãƒ­ã‚°ã‚’èµ°æŸ»
- `~/.claude/projects/**/*.jsonl` ã‚’å¯¾è±¡
- çµæœã¯å…±æœ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜: `/tmp/ccusage-cache.json`
- å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® status-line.sh ãŒã“ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‚ç…§

#### ãƒ¢ãƒ‡ãƒ«è¡¨ç¤ºï¼ˆå€‹åˆ¥ï¼‰
- å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® `transcript_path` ã‹ã‚‰æœ€æ–°ã® assistant ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
- ãã®å¿œç­”ã®ãƒ¢ãƒ‡ãƒ«åã‚’è¡¨ç¤º
- Claude Code ãŒæ¸¡ã™ JSON ã® `transcript_path` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ç”¨

### 2.4 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª                          â”‚
â”‚              ~/.claude/projects/                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ project-a/      â”‚  â”‚ project-b/      â”‚                   â”‚
â”‚  â”‚  session-1.jsonlâ”‚  â”‚  session-2.jsonlâ”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              get-message-usage.py                            â”‚
â”‚  - å…¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ°æŸ»                                      â”‚
â”‚  - ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»é‡ã‚’åˆè¨ˆ                                      â”‚
â”‚  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              /tmp/ccusage-cache.json                         â”‚
â”‚  {                                                           â”‚
â”‚    "tokens": { "weighted": { "total": 825000 } },           â”‚
â”‚    "usage": { "percent": 45 }                                â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ A     â”‚           â”‚ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ B     â”‚
â”‚ status-line.sh    â”‚           â”‚ status-line.sh    â”‚
â”‚                   â”‚           â”‚                   â”‚
â”‚ å…¥åŠ›:             â”‚           â”‚ å…¥åŠ›:             â”‚
â”‚ - transcript_path â”‚           â”‚ - transcript_path â”‚
â”‚   (session-1.jsonl)â”‚          â”‚   (session-2.jsonl)â”‚
â”‚                   â”‚           â”‚                   â”‚
â”‚ å‡¦ç†:             â”‚           â”‚ å‡¦ç†:             â”‚
â”‚ 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰  â”‚           â”‚ 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰  â”‚
â”‚    åˆè¨ˆä½¿ç”¨ç‡å–å¾—  â”‚           â”‚    åˆè¨ˆä½¿ç”¨ç‡å–å¾—  â”‚
â”‚ 2. è‡ªèº«ã®ãƒ­ã‚°ã‹ã‚‰  â”‚           â”‚ 2. è‡ªèº«ã®ãƒ­ã‚°ã‹ã‚‰  â”‚
â”‚    ãƒ¢ãƒ‡ãƒ«åå–å¾—    â”‚           â”‚    ãƒ¢ãƒ‡ãƒ«åå–å¾—    â”‚
â”‚                   â”‚           â”‚                   â”‚
â”‚ å‡ºåŠ›:             â”‚           â”‚ å‡ºåŠ›:             â”‚
â”‚ [Opus 4.5] 5h:45% â”‚           â”‚ [Sonnet 4.5] 5h:45%â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ãƒ¢ãƒ‡ãƒ«åˆ¥é‡ã¿ä»˜ã‘ï¼ˆå…¬å¼ä¾¡æ ¼ãƒ™ãƒ¼ã‚¹ï¼‰

### 3.1 APIä¾¡æ ¼ï¼ˆ2025å¹´æ™‚ç‚¹ï¼‰

| ãƒ¢ãƒ‡ãƒ« | å…¥åŠ› ($/MTok) | å‡ºåŠ› ($/MTok) |
|--------|--------------|--------------|
| Opus 4.5 | $15 | $75 |
| Sonnet 4.5 | $3 | $15 |
| Haiku 4.5 | $1 | $5 |

### 3.2 æ¶ˆè²»æ¯”ç‡ï¼ˆSonnet = 1.0 åŸºæº–ï¼‰

| ãƒ¢ãƒ‡ãƒ« | å…¥åŠ›æ¯”ç‡ | å‡ºåŠ›æ¯”ç‡ | ç·åˆæ¯”ç‡ |
|--------|---------|---------|---------|
| Opus | 5.0 | 5.0 | **5.0** |
| Sonnet | 1.0 | 1.0 | **1.0** |
| Haiku | 0.33 | 0.33 | **0.33** |

### 3.3 è¨­å®šå€¤

```python
MODEL_WEIGHTS = {
    'opus': 5.0,      # Sonnet ã® 5å€
    'sonnet': 1.0,    # åŸºæº–
    'haiku': 0.33,    # Sonnet ã® 1/3
}
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

### 4.1 ç›£è¦–å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ

**å¤‰æ›´å‰**: `type: user | UserPromptSubmit | user_prompt`
**å¤‰æ›´å¾Œ**: `type: assistant`

### 4.2 å–å¾—ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

```json
{
  "type": "assistant",
  "timestamp": "2026-01-05T12:30:00Z",
  "isSidechain": false,
  "message": {
    "model": "claude-opus-4-5-20251101",
    "stop_reason": "end_turn",
    "usage": {
      "input_tokens": 10000,
      "output_tokens": 500,
      "cache_creation_input_tokens": 5000,
      "cache_read_input_tokens": 8000
    }
  }
}
```

### 4.3 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¡ä»¶

1. `type == "assistant"`
2. `message.stop_reason` ãŒå­˜åœ¨ï¼ˆæœ€çµ‚å¿œç­”ã®ã¿ï¼‰
3. `timestamp` ãŒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†…
4. `isSidechain == false`ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³: ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé™¤å¤–ï¼‰

---

## 5. ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»é‡ã®è¨ˆç®—

### 5.1 åŸºæœ¬è¨ˆç®—å¼

```python
def calculate_weighted_tokens(usage, model_name):
    """é‡ã¿ä»˜ã‘ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’è¨ˆç®—"""
    weight = MODEL_WEIGHTS.get(get_model_type(model_name), 1.0)

    # å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­ã¿å–ã‚Šã¯å‰²å¼•ï¼‰
    input_tokens = usage['input_tokens']
    cache_read = usage.get('cache_read_input_tokens', 0)
    cache_create = usage.get('cache_creation_input_tokens', 0)

    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­ã¿å–ã‚Šã¯ 10% ã®æ¶ˆè²»ï¼ˆ90% å‰²å¼•ï¼‰
    effective_input = input_tokens + cache_create + (cache_read * 0.1)

    # å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³
    output_tokens = usage['output_tokens']

    # é‡ã¿ä»˜ã‘é©ç”¨
    weighted_input = effective_input * weight
    weighted_output = output_tokens * weight

    return {
        'raw_input': input_tokens + cache_create + cache_read,
        'raw_output': output_tokens,
        'weighted_input': weighted_input,
        'weighted_output': weighted_output,
        'total_weighted': weighted_input + weighted_output
    }
```

### 5.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ‰±ã„

| ãƒˆãƒ¼ã‚¯ãƒ³ç¨®åˆ¥ | æ¶ˆè²»ä¿‚æ•° | ç†ç”± |
|-------------|---------|------|
| input_tokens | 1.0 | é€šå¸¸å…¥åŠ› |
| cache_creation_input_tokens | 1.0 | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½œæˆï¼ˆãƒ•ãƒ«èª²é‡‘ï¼‰ |
| cache_read_input_tokens | 0.1 | ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­ã¿å–ã‚Šï¼ˆ90%å‰²å¼•ï¼‰ |
| output_tokens | 1.0 | é€šå¸¸å‡ºåŠ› |

---

## 6. å‡ºåŠ›å½¢å¼

### 6.1 JSON å‡ºåŠ›æ§‹é€ 

```json
{
  "plan": "max-100",
  "windowHours": 5,
  "windowStart": "2026-01-05T07:30:00+00:00",
  "windowEnd": "2026-01-05T12:30:00+00:00",
  "timeUntilReset": 18000,
  "calculatedAt": "2026-01-05T10:00:00+00:00",

  "tokens": {
    "raw": {
      "input": 500000,
      "output": 50000,
      "total": 550000
    },
    "weighted": {
      "input": 750000,
      "output": 75000,
      "total": 825000
    }
  },

  "modelBreakdown": {
    "opus": {
      "requests": 5,
      "rawTokens": 150000,
      "weightedTokens": 750000
    },
    "sonnet": {
      "requests": 20,
      "rawTokens": 400000,
      "weightedTokens": 400000
    },
    "haiku": {
      "requests": 0,
      "rawTokens": 0,
      "weightedTokens": 0
    }
  },

  "calibration": {
    "limitTokens": 2000000,
    "source": "estimated",
    "lastCalibratedAt": null
  },

  "usage": {
    "percent": 41,
    "remaining": 1175000
  },

  "legacy": {
    "messageCount": 25,
    "messagePercent": 11
  }
}
```

---

## 7. ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

### 7.1 ç›®çš„

100% åˆ°é”æ™‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ç·é‡ã‚’è¨˜éŒ²ã—ã€æ¬¡å›ä»¥é™ã®è¨ˆç®—ç²¾åº¦ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

### 7.2 ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«**: `~/.claude/usage-calibration.json`

```json
{
  "plan": "max-100",
  "calibrations": [
    {
      "timestamp": "2026-01-05T12:00:00Z",
      "observedLimitTokens": 2100000,
      "modelMix": {
        "opus": 0.2,
        "sonnet": 0.8
      },
      "notes": "100% åˆ°é”æ™‚ã«æ‰‹å‹•è¨˜éŒ²"
    }
  ],
  "currentEstimate": {
    "limitTokens": 2100000,
    "confidence": "calibrated",
    "updatedAt": "2026-01-05T12:00:00Z"
  }
}
```

### 7.3 åˆæœŸæ¨å®šå€¤ï¼ˆã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ï¼‰

| ãƒ—ãƒ©ãƒ³ | æ¨å®šåˆ¶é™ãƒˆãƒ¼ã‚¯ãƒ³ | æ ¹æ‹  |
|--------|----------------|------|
| free | 150,000 | 15 msg Ã— 10K tokens |
| pro | 450,000 | 45 msg Ã— 10K tokens |
| max-100 | 2,250,000 | Pro Ã— 5 |
| max-200 | 9,000,000 | Pro Ã— 20 |

---

## 8. status-line.sh ã®æ”¹å–„

### 8.1 ãƒ¢ãƒ‡ãƒ«è¡¨ç¤ºã®æ”¹å–„ï¼ˆå€‹åˆ¥è¡¨ç¤ºï¼‰

å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® `transcript_path` ã‹ã‚‰æœ€æ–°ã®ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’å–å¾—ï¼š

```bash
# JSONLãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æœ€æ–°ã®ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’å–å¾—ï¼ˆå€‹åˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”¨ï¼‰
TRANSCRIPT_PATH=$(echo "$input" | jq -r '.transcript_path // ""')
MODEL="Unknown"

if [ -n "$TRANSCRIPT_PATH" ] && [ -f "$TRANSCRIPT_PATH" ]; then
    RAW_MODEL=$(tail -100 "$TRANSCRIPT_PATH" 2>/dev/null | \
        grep '"type":"assistant"' | \
        tail -1 | \
        grep -o '"model":"[^"]*"' | \
        sed 's/"model":"//;s/"//')

    if [ -n "$RAW_MODEL" ]; then
        if echo "$RAW_MODEL" | grep -qi "opus"; then
            MODEL="Opus 4.5"
        elif echo "$RAW_MODEL" | grep -qi "sonnet"; then
            MODEL="Sonnet 4.5"
        elif echo "$RAW_MODEL" | grep -qi "haiku"; then
            MODEL="Haiku"
        else
            MODEL="$RAW_MODEL"
        fi
    fi
fi
```

### 8.2 ä½¿ç”¨ç‡ã®å–å¾—ï¼ˆåˆè¨ˆè¡¨ç¤ºï¼‰

å…±æœ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰åˆè¨ˆä½¿ç”¨ç‡ã‚’å–å¾—ï¼š

```bash
# å…±æœ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰åˆè¨ˆä½¿ç”¨ç‡ã‚’å–å¾—
MESSAGE_CACHE="/tmp/ccusage-cache.json"
USAGE_PERCENT=0

if [ -f "$MESSAGE_CACHE" ]; then
    # ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®ä½¿ç”¨ç‡ã‚’å–å¾—ï¼ˆæ–°å½¢å¼ï¼‰
    USAGE_PERCENT=$(jq -r '.usage.percent // .messagePercent // 0' "$MESSAGE_CACHE" 2>/dev/null)
fi

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³å‡ºåŠ›
# ãƒ¢ãƒ‡ãƒ«: å€‹åˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚‚ã®
# ä½¿ç”¨ç‡: å…¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åˆè¨ˆ
echo -e "[$MODEL] ğŸ“ $DIR_NAME | 5h:${USAGE_PERCENT}%"
```

---

## 9. å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èµ°æŸ»               â”‚
â”‚    ~/.claude/projects/**/*.jsonl        â”‚
â”‚    ï¼ˆå…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»å…¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. assistant ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ½å‡º             â”‚
â”‚    - type == "assistant"                â”‚
â”‚    - stop_reason ãŒå­˜åœ¨                 â”‚
â”‚    - timestamp ãŒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†…           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å„ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’è¨ˆç®—         â”‚
â”‚    - usage ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å–å¾—         â”‚
â”‚    - ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­ã¿å–ã‚Šã¯ 0.1 ä¿‚æ•°      â”‚
â”‚    - ãƒ¢ãƒ‡ãƒ«åˆ¥é‡ã¿ä»˜ã‘ã‚’é©ç”¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åˆè¨ˆã‚’é›†è¨ˆï¼ˆå…¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹çµ±åˆï¼‰     â”‚
â”‚    - ç”Ÿãƒˆãƒ¼ã‚¯ãƒ³æ•°                       â”‚
â”‚    - é‡ã¿ä»˜ã‘ãƒˆãƒ¼ã‚¯ãƒ³æ•°                 â”‚
â”‚    - ãƒ¢ãƒ‡ãƒ«åˆ¥å†…è¨³                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ä½¿ç”¨ç‡ã‚’è¨ˆç®—                         â”‚
â”‚    - ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å€¤ã§å‰²ã‚‹         â”‚
â”‚    - ã¾ãŸã¯åˆæœŸæ¨å®šå€¤ã§å‰²ã‚‹             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å…±æœ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜                 â”‚
â”‚    /tmp/ccusage-cache.json              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® status-line.sh ãŒ   â”‚
â”‚    - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰åˆè¨ˆä½¿ç”¨ç‡ã‚’å–å¾—     â”‚
â”‚    - è‡ªèº«ã®ãƒ­ã‚°ã‹ã‚‰å€‹åˆ¥ãƒ¢ãƒ‡ãƒ«åã‚’å–å¾—   â”‚
â”‚    - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ã‚’å‡ºåŠ›             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ä¸€è¦§

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|---------|---------|
| `get-message-usage.py` | ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹è¨ˆç®—ã«å…¨é¢æ”¹ä¿® |
| `usage-config.json` | ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šè¿½åŠ  |
| `status-line.sh` | ãƒ¢ãƒ‡ãƒ«å€‹åˆ¥è¡¨ç¤º + ä½¿ç”¨ç‡åˆè¨ˆè¡¨ç¤º |
| `status-line.ps1` | åŒä¸Šï¼ˆWindowsç‰ˆï¼‰ |
| `ccusage-daemon.mjs` | å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ |

---

## 11. å¾Œæ–¹äº’æ›æ€§

### 11.1 ãƒ¬ã‚¬ã‚·ãƒ¼å‡ºåŠ›ã®ç¶­æŒ

æ—¢å­˜ã® `messageCount`, `messagePercent` ã‚‚å‡ºåŠ›ã«å«ã‚ã‚‹ï¼ˆ`legacy` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã€‚

### 11.2 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®äº’æ›æ€§

`usage-config.json` ã®æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ç¶­æŒã—ã€æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã€‚

---

## 12. å‚è€ƒæƒ…å ±

### Sources
- [Claude Sonnet 4.5 vs Opus for Claude Code](https://claudelog.com/faqs/claude-4-sonnet-vs-opus/)
- [What does "more usage" in Claude 4.5 Limits actually mean](https://medium.com/@Gunratna/what-does-more-usage-in-claude-4-5-limits-actually-mean-explained-for-opus-sonnet-haiku-720535b70d55)
- [About Claude's Max Plan Usage](https://support.claude.com/en/articles/11014257-about-claude-s-max-plan-usage)
- [Anthropic API Pricing](https://www.nops.io/blog/anthropic-api-pricing/)
